pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
function _init()
 -- make player top left
 pl = {}
 pl.x = 2
	pl.y = 2
 pl.dx = 0
 pl.dy = 0
 pl.spr = 1
 
 -- half-width and half-height
 -- slightly less than 0.5 so
 -- that will fit through 1-wide
 -- holes.
 pl.w = 0.4
 pl.h = 0.4
 
end

-- for any given point on the
-- map, true if there is wall
-- there.

function solid(x, y)

 -- grab the cell value
 val=mget(x, y)
 
 -- check if flag 0 is set (the
 -- red toggle button in the 
 -- sprite editor)
 return fget(val, 0)
 
end

-- solid_area
-- check if a rectangle overlaps
-- with any walls

function solid_area(x,y,w,h)

 return 
  solid(x-w,y-h) or
  solid(x+w,y-h) or
  solid(x-w,y+h) or
  solid(x+w,y+h)
end

function move_player(pl)

 -- only move actor along x
 -- if the resulting position
 -- will not overlap with a wall

 if not solid_area(pl.x + pl.dx, 
  pl.y, pl.w, pl.h) then
  pl.x += pl.dx
 end

 -- ditto for y

 if not solid_area(pl.x, 
  pl.y + pl.dy, pl.w, pl.h) then
  pl.y += pl.dy
 end
 
 --reset the look-ahead value
 
 pl.dx = 0
 pl.dy = 0
 
end

function control_player(pl)

 if (btn(0)) pl.dx -= 0.1 
 if (btn(1)) pl.dx += 0.1 
 if (btn(2)) pl.dy -= 0.1 
 if (btn(3)) pl.dy += 0.1
 
end

function _update()
 control_player(pl)
 move_player(pl)
end

function draw_player(pl)
 local sx = (pl.x * 8) - 4
 local sy = (pl.y * 8) - 4
 spr(pl.spr, sx, sy)
end

function _draw()
 cls()
 map(0,0,0,0,16,16)
 draw_player(pl)
 
 print("x "..pl.x,0,120,7)
 print("y "..pl.y,64,120,7)
 
end

__gfx__
00000000cccccccc9999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c000000c9999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700c000000c9999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000c000000c9999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000c000000c9999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700c000080c9999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000c000000c9999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000cccccccc9999999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020202020202020202020202020202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
